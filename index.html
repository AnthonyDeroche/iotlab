<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>IoTLab by AnthonyDeroche</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/AnthonyDeroche/iotlab">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/AnthonyDeroche/iotlab/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/AnthonyDeroche/iotlab/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>IoTLab</h1>
          <p>Internet of Things architecture including an embedded application in sky motes, a gateway, and a web application in JEE</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/AnthonyDeroche">AnthonyDeroche</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h3>
<a name="welcome-to-the-iotlab-project-page" class="anchor" href="#welcome-to-the-iotlab-project-page"><span class="octicon octicon-link"></span></a>Welcome to the IoTLab project page.</h3>

<p>This project is the outcome of one school project and three internships at INRIA Nancy - Grand Est in France. The architecture is composed of an embedded application in sky motes, a gateway in charge of relaying collected data to the server application. The different steps to set up the server our application are described thereafter. As well as we did, you might find useful to add HTTPS or a proxy on server side. These optional steps are described at the end of the page.</p>

<h3>
<a name="summary-" class="anchor" href="#summary-"><span class="octicon octicon-link"></span></a>Summary :</h3>

<ul>
<li><a href="#install-java-ee-platform-with-glassfish-4">Install Java EE platform with Glassfish 4</a></li>
<li><a href="#deploy-our-application">Deploy our application</a></li>
<li><a href="#set-up-a-certificate-with-https-in-glassfish">Set up a certificate with HTTPS in Glassfish</a></li>
<li><a href="#set-up-a-proxy-by-using-apache-as-front-end-server">Set up a proxy by using Apache as front-end server</a></li>
<li><a href="#contributors-and-supervisors">Contributors</a></li>
<li><a href="#contact">Contact</a></li>
</ul><p>To clone the repository : </p>

<pre><code>$ cd your_folder/
$ git clone https://github.com/AnthonyDeroche/iotlab.git

</code></pre>

<h2>
<a name="install-java-ee-platform-with-glassfish-4" class="anchor" href="#install-java-ee-platform-with-glassfish-4"><span class="octicon octicon-link"></span></a>Install Java EE platform with Glassfish 4</h2>

<p>Our application requires Java EE 7 and that's why you need <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank">JDK 7 </a>(or above). <br>
Glassfish 4 with Java EE 7 environnement can be downloaded at this link : <a href="https://glassfish.java.net/download.html" target="_blank">Glassfish 4</a>.
Once you have unzipped the glassfish folder, you can start the server by running :</p>

<pre><code>./bin/asadmin start-domain
</code></pre>

<p>If the server is working, you should be able to reach the administration page at <a href="http://localhost:4848/" target="_blank">http://localhost:4848/</a>, and the default page at <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a>.</p>

<p>You should change the admin password by entering this command : </p>

<pre><code>./bin/asadmin --user admin change-admin-password
</code></pre>

<p>If the server is on a remote machine, you may need to enable a remote access : </p>

<pre><code>./asadmin enable-secure-admin
./asadmin restart-domain
</code></pre>

<h2>
<a name="deploy-our-application" class="anchor" href="#deploy-our-application"><span class="octicon octicon-link"></span></a>Deploy our application</h2>

<p>We use MySQL as DBMS. So if you don't have MySQL installed, open a terminal and enter the following command : </p>

<pre><code>sudo apt-get install mysql-server

</code></pre>

<p>To manage the database, we advise you to use phpmyadmin : </p>

<pre><code>sudo apt-get install apache2 php5 mysql-server phpmyadmin

</code></pre>

<p>The next step is to configure Glassfish to connect to the MySQL database. In our project, we use a connection pool named BoneCP. We advise you to create a specific user and database. That can be done with phpmyadmin. We provide you a resource file that can be directly imported in Glassfish via the administration interface or in command line. This file is located in server/lib/bonecp-datasource.xml. You have to change several lines to match with your user and database name.</p>

<pre><code>&lt;property name="jdbcUrl" value="jdbc:mysql://localhost:3306/iotlab"/&gt;
&lt;property name="user" value="admin"/&gt;
&lt;property name="password" value="admin"/&gt;
</code></pre>

<p>To import the file, copy it, go in the glassfish folder and then the bin folder and paste the file. Enter the following command : </p>

<pre><code>./asadmin add-resources bonecp-datasource.xml
</code></pre>

<p>The next step is to provide to Glassfish the libraries used by the application. Copy all jar files from the <strong>server/lib/</strong> folder to <strong>glassfish4/glassfish/domains/domain1/lib/ext/</strong>.</p>

<p>By now, the server should be ready to deploy our application. You need to import the war file which is located in your git repository at server/bin/iotlab.war. This can be done via the administration interface or by entering the following command (in the bin folder) : </p>

<pre><code>./asadmin deploy path_to/iotlab.war
</code></pre>

<p>All should be working fine. </p>

<h2>
<a name="set-up-a-certificate-with-https-in-glassfish" class="anchor" href="#set-up-a-certificate-with-https-in-glassfish"><span class="octicon octicon-link"></span></a>Set up a certificate with HTTPS in Glassfish</h2>

<p>In this section, I suppose you already have a certificate (.crt) signed by an authority or self-signed and a private key (.key).</p>

<p>It's strongly advised to change your master password, because it's used to read the key store managed by Glassfish. The default password is changeit. </p>

<pre><code>./asadmin change-master-password
</code></pre>

<p>First of all, you need to convert those files to a PKCS#12 (PFX) key store and precise an alias. This alias will be used by Glassfish. You will be asked to enter an export password.</p>

<pre><code>openssl pkcs12 -export -out certificate.p12 -inkey server.key -in server.crt -certfile CACert.pem -name myAlias
</code></pre>

<p>In this example, CACert.pem is the name of the root certificate that was returned by the certificate authority.</p>

<p>The second step is to add the PKCS#12 key store to the existing key store in Glassfish located in glassfish4/glassfish/domains/domain1/config/.</p>

<pre><code>keytool -v -importkeystore -srckeystore certificate.p12 -srcstoretype PKCS12 -srcalias myAlias -destkeystore keystore.jks -deststoretype JKS -destalias myAlias
</code></pre>

<p>You can check out the content of the keystore by entering this following command : </p>

<pre><code>keytool -list -keystore keystore.jks
</code></pre>

<p>In glassfish, the default http listener configured to use TLS is http-listener-2 and the default port used is 8181. You need to go in admin interface, browse to Configuartions/server-config/HTTP Service/Http Listeners/http-listener-2/ and the SSL tab. The Certificate NickName must be the alias you chose in your JKS file.</p>

<p>You just need to restart the domain and you're normally done.</p>

<pre><code>./asadmin restart-domain
</code></pre>

<p>Check it at <a href="https://localhost:8181/" target="_blank">https://localhost:8181/</a></p>

<p>Finally, on the computer where the gateway is executed, it can be required to add the certificate as trusted certificate especially in case of self-signed certificate. You need to convert it in PEM file. Well-configured, it allows the gateway to connect to the server using TLS and prevents java from printing out an error due to unknown or untrusted certificate.</p>

<pre><code>keytool -import -alias myAlias -file cert.pem -keystore /etc/ssl/certs/java/cacerts
</code></pre>

<p>cert.pem can be your self-signed certificate (converted to PEM file) or the root certificate of an authority.</p>

<h2>
<a name="set-up-a-proxy-by-using-apache-as-front-end-server" class="anchor" href="#set-up-a-proxy-by-using-apache-as-front-end-server"><span class="octicon octicon-link"></span></a>Set up a proxy by using Apache as front-end server</h2>

<h2>
<a name="contributors-and-supervisors" class="anchor" href="#contributors-and-supervisors"><span class="octicon octicon-link"></span></a>Contributors and Supervisors</h2>

<ul>
<li>Anthony Deroche (<a href="https://github.com/AnthonyDeroche" class="user-mention">@AnthonyDeroche</a>), TELECOM Nancy</li>
<li>Thierry Duhal, TELECOM Nancy</li>
<li>Arthur Garnier, IUT Nancy Charlemagne</li>
<li>Thibault Cholez, Associate Professor, INRIA</li>
<li>Emmanuel Nataf, Associate Professor, INRIA</li>
</ul><h2>
<a name="contact" class="anchor" href="#contact"><span class="octicon octicon-link"></span></a>Contact</h2>

<ul>
<li><a href="mailto:anthony.deroche@telecomnancy.eu">anthony.deroche@telecomnancy.eu</a></li>
<li><a href="mailto:thierry.duhal@telecomnancy.eu">thierry.duhal@telecomnancy.eu</a></li>
<li><a href="mailto:arthur.garnier1@etu.univ-lorraine.fr">arthur.garnier1@etu.univ-lorraine.fr</a></li>
<li><a href="mailto:thibault.cholez@inria.fr">thibault.cholez@inria.fr</a></li>
<li><a href="mailto:emmanuel.nataf@inria.fr">emmanuel.nataf@inria.fr</a></li>
</ul><h3>
<a name="links" class="anchor" href="#links"><span class="octicon octicon-link"></span></a>Links</h3>

<ul>
<li>
<a href="http://www.telecomnancy.eu/" target="_blank"></a><a href="http://www.telecomnancy.eu/">http://www.telecomnancy.eu/</a>
</li>
<li>
<a href="http://www.inria.fr/" target="_blank"></a><a href="http://www.inria.fr/">http://www.inria.fr/</a>
</li>
<li>
<a href="http://www.loria.fr/" target="_blank"></a><a href="http://www.loria.fr/">http://www.loria.fr/</a>
</li>
<li>
<a href="http://iut-charlemagne.univ-lorraine.fr/" target="_blank"></a><a href="http://iut-charlemagne.univ-lorraine.fr/">http://iut-charlemagne.univ-lorraine.fr/</a>
</li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>